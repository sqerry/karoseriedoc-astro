---
import { useTranslations, type Lang, defaultLang } from '../i18n';
import { getRelativeLocaleUrl } from 'astro:i18n';

interface Props {
    lang?: Lang;
}

const { lang = 'cs' } = Astro.props;
const t = useTranslations(lang);

// Helper to build localized paths
const localePath = (path: string) => {
    if (lang === defaultLang) {
        return path;
    }
    return `/${lang}${path}`;
};

// Route mappings for German
const routes = {
    cs: {
        sluzby: '/sluzby',
        galerie: '/galerie',
        kontakt: '/kontakt',
    },
    de: {
        sluzby: '/de/dienstleistungen',
        galerie: '/de/galerie',
        kontakt: '/de/kontakt',
    },
};
---

<nav class="site-nav">
    <ul>
        <li><a href={localePath('/')}>{t('nav.home')}</a></li>
        <li><a id="about-link" href={localePath('/#about-section')}>{t('nav.about')}</a></li>
        <li><a href={routes[lang].galerie}>{t('nav.gallery')}</a></li>
        <li>
            <a id="services-link" href={routes[lang].sluzby}>{t('nav.services')}</a>
        </li>
        <li><a href={routes[lang].kontakt}>{t('nav.contact')}</a></li>
    </ul>
</nav>
<script>
    function updateAboutLink() {
        const aboutLinks = document.querySelectorAll('#about-link')
        const htmlLang = document.documentElement.lang

        aboutLinks.forEach((aboutLink) => {
            if (htmlLang === 'cs') {
                aboutLink.setAttribute('href', '/#about-section')
            } else {
                aboutLink.setAttribute('href', `/${htmlLang}/#about-section`)
            }

            // Add event listener for click if screen width is 1023px or less
            if (window.innerWidth <= 1023) {
                aboutLink.addEventListener('click', () => {
                    document.body.classList.remove('hamburger-active')
                    document.querySelector('.hamburger-menu').classList.remove('active')
                })
            }
        })
    }

    document.addEventListener('DOMContentLoaded', updateAboutLink)
    document.addEventListener('astro:after-swap', updateAboutLink)
</script>

<style lang="scss">
    nav {
        width: 50%;

        @media (max-width: 1023px) {
            display: none;
        }

        .lang-switcher {
            background-color: $clr-black;
            cursor: pointer;
            @media (min-width: 1024px) {
                display: none;
            }
        }
    }
    ul {
        display: flex;
        justify-content: center;
        gap: 3.2rem;

        li {
            display: flex;

            a {
                color: $clr-white;
                font-size: 2rem;
                font-weight: 700;
                padding: 1.6rem 0;

                &.active-page {
                    color: $clr-primary;
                }
            }
        }
    }
</style>
